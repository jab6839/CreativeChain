{% extends "base.html" %}
{% block content %}

<h2 style="text-align:center;">Clinic Calendar</h2>

<div id="calendar" style="max-width:1100px;margin:auto;"></div>

<!-- Quick Add Event -->
<div style="max-width:800px;margin:20px auto 0;">
  <form method="POST" action="{{ url_for('add_calendar_event') }}" style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;">
    <input type="text" name="title" placeholder="Event Title" required>
    <input type="datetime-local" name="start" required>
    <input type="datetime-local" name="end">
    <button type="submit">Add Event</button>
  </form>
</div>

<!-- FullCalendar assets -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const calendarEl = document.getElementById('calendar');

  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    height: 'auto',
    headerToolbar: {
      left: 'prev,next today',
      center: 'title',
      right: 'dayGridMonth,timeGridWeek,timeGridDay,listWeek'
    },
    nowIndicator: true,
    navLinks: true,
    events: "{{ url_for('api_events') }}", // fetch from Flask JSON API
    eventClick: function(info) {
      const id = info.event.extendedProps.id || info.event.id;
      if (!id) return;
      if (confirm('Delete this event: "' + info.event.title + '" ?')) {
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/calendar/delete/' + id;
        document.body.appendChild(form);
        form.submit();
      }
    }
  });

  calendar.render();
});
</script>

{% endblock %}

