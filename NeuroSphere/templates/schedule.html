{% extends "base.html" %}
{% block content %}

<div class="container" style="max-width:1100px;margin:auto;">
  <h2>Schedules</h2>

  <!-- Add / Edit Schedule -->
  <!-- Post back to the existing 'schedule' endpoint with action=save -->
  <form id="schedule-form" method="POST" action="{{ url_for('schedule') }}" style="margin-top:16px;">
    <input type="hidden" name="action" value="save">
    <input type="hidden" name="id" id="sch-id">

    <div style="display:flex;flex-wrap:wrap;gap:10px;justify-content:center;">
      <input class="input-box same-width" style="width:240px" type="text" name="title" id="sch-title" placeholder="Title (e.g., Clinic â€“ New Patients)" required>
      <input class="input-box same-width" style="width:160px" type="date" name="date" id="sch-date" required>
      <input class="input-box same-width" style="width:120px" type="time" name="start_time" id="sch-start" required>
      <input class="input-box same-width" style="width:120px" type="time" name="end_time" id="sch-end">
      <input class="input-box same-width" style="width:180px" type="text" name="provider" id="sch-provider" placeholder="Provider (e.g., Dr. Smith)">
      <input class="input-box same-width" style="width:160px" type="text" name="location" id="sch-location" placeholder="Location (e.g., Room 3)">
      <select class="input-box same-width" style="width:150px" name="status" id="sch-status">
        <option>Scheduled</option>
        <option>Completed</option>
        <option>Cancelled</option>
      </select>
    </div>

    <div style="display:flex;justify-content:center;margin-top:10px;">
      <textarea class="input-box same-width" style="width:740px;height:70px" name="notes" id="sch-notes" placeholder="Notes"></textarea>
    </div>

    <div style="display:flex;gap:10px;justify-content:center;margin-top:10px;">
      <button type="submit">Save</button>
      <button type="button" onclick="resetForm()">Reset</button>
    </div>
  </form>

  <!-- Schedule Table -->
  <div style="overflow-x:auto;margin-top:24px;">
    <table class="ns-table" style="width:100%;border-collapse:collapse;">
      <thead>
        <tr>
          <th style="text-align:left;padding:10px;">Title</th>
          <th style="text-align:left;padding:10px;">Date</th>
          <th style="text-align:left;padding:10px;">Start</th>
          <th style="text-align:left;padding:10px;">End</th>
          <th style="text-align:left;padding:10px;">Provider</th>
          <th style="text-align:left;padding:10px;">Location</th>
          <th style="text-align:left;padding:10px;">Status</th>
          <th style="text-align:left;padding:10px;">Notes</th>
          <th style="text-align:left;padding:10px;">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for s in schedules %}
        <tr>
          <td style="padding:10px;">{{ s.title }}</td>
          <td style="padding:10px;">{{ s.date }}</td>
          <td style="padding:10px;">{{ s.start_time }}</td>
          <td style="padding:10px;">{{ s.end_time }}</td>
          <td style="padding:10px;">{{ s.provider }}</td>
          <td style="padding:10px;">{{ s.location }}</td>
          <td style="padding:10px;">{{ s.status }}</td>
          <td style="padding:10px;max-width:280px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="{{ s.notes }}">{{ s.notes }}</td>
          <td style="padding:10px;">
            <button type="button" onclick='fillForm({{ s|tojson }})'>Edit</button>

            <!-- Delete posts to the same 'schedule' endpoint with action=delete -->
            <form method="POST" action="{{ url_for('schedule') }}" style="display:inline;">
              <input type="hidden" name="action" value="delete">
              <input type="hidden" name="id" value="{{ s.id }}">
              <button type="submit" style="background:#dc3545;margin-left:6px;">Delete</button>
            </form>
          </td>
        </tr>
        {% else %}
        <tr><td colspan="9" style="padding:14px;">No schedules yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
function fillForm(s) {
  document.getElementById('sch-id').value = s.id || '';
  document.getElementById('sch-title').value = s.title || '';
  document.getElementById('sch-date').value = s.date || '';
  document.getElementById('sch-start').value = s.start_time || '';
  document.getElementById('sch-end').value = s.end_time || '';
  document.getElementById('sch-provider').value = s.provider || '';
  document.getElementById('sch-location').value = s.location || '';
  document.getElementById('sch-status').value = s.status || 'Scheduled';
  document.getElementById('sch-notes').value = s.notes || '';
  window.scrollTo({top: 0, behavior: 'smooth'});
}

function resetForm() {
  document.getElementById('schedule-form').reset();
  document.getElementById('sch-id').value = '';
}
</script>

<style>
  /* Table theming that respects your light/dark */
  .ns-table th { border-bottom: 2px solid #e5e5e5; }
  .ns-table td { border-bottom: 1px solid #efefef; }
  body.dark-mode .ns-table th { border-bottom-color: #555; }
  body.dark-mode .ns-table td { border-bottom-color: #444; }
</style>

{% endblock %}

