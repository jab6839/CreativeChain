{% extends "base.html" %}
{% block content %}

<div class="container" style="max-width: 920px; margin: 0 auto;">

  <h1 style="text-align:center; margin: 20px 0;">Clinic Log</h1>

  <!-- Filter bar -->
  <div class="filter-bar" style="display:flex; gap:10px; justify-content:center; flex-wrap:wrap; margin-bottom: 15px;">
    {% set filters = ['all'] + note_types %}
    {% for f in filters %}
      <a
        href="{{ url_for('clinic_log', filter=f) }}"
        class="filter-chip {% if current_filter == f %}active{% endif %}"
        style="padding:6px 12px; border-radius:20px; text-decoration:none; font-weight:600;
               background: {% if current_filter == f %}#6a0dad{% else %}#eee{% endif %};
               color: {% if current_filter == f %}#fff{% else %}#333{% endif %};">
        {{ f }}
      </a>
    {% endfor %}
  </div>

  <!-- Add note form -->
  <form method="POST" action="{{ url_for('clinic_log', filter=current_filter) }}" class="note-form" style="display:flex; gap:10px; align-items:flex-start; flex-wrap:wrap; justify-content:center; margin-bottom:15px;">
    <input class="input-box same-width" name="title" placeholder="Note Title" required />
    <textarea class="input-box same-width" name="content" placeholder="Note Content" rows="3" required></textarea>

    <select name="note_type" class="input-box" style="width: 180px;">
      {% for t in note_types %}
        <option value="{{ t }}">{{ t }}</option>
      {% endfor %}
    </select>

    <button type="submit">Add Note</button>
  </form>

  <!-- Suggestions dropdown (auto-fills title/content) -->
  <div class="note-suggestions" style="max-width:920px; margin: 0 auto 20px auto; display:flex; gap:10px; align-items:center; justify-content:center;">
    <label for="templateSelect">Suggestions:</label>
    <select id="templateSelect" class="input-box" style="width:220px;">
      <option value="">-- Select a template --</option>
      {% for t in note_types %}
        <option value="{{ t }}">{{ t }}</option>
      {% endfor %}
    </select>
  </div>

  <!-- Notes board -->
  <div class="note-board" style="display:flex; flex-direction:column; gap:16px; max-width:920px; margin: 0 auto;">
    {% for n in notes %}
      <div class="sticky-note" style="background:#FFF59D; border:1px solid #E6DF7A; padding:18px; border-radius:10px; box-shadow:0 3px 10px rgba(0,0,0,0.08);">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:8px;">
          <strong style="font-size:18px;">{{ n.title }}</strong>
          <span class="badge" style="background:#eee; border-radius:12px; padding:2px 8px; font-size:12px; color:#333;">{{ n.type or 'General' }}</span>
        </div>
        <div style="white-space:pre-wrap; margin-bottom:10px;">{{ n.content }}</div>
        <form method="POST" action="{{ url_for('delete_note', index=loop.index0, **{'filter': current_filter}) }}">
          <button type="submit" style="background:#6a0dad; color:#fff;">Delete</button>
        </form>
      </div>
    {% endfor %}
  </div>

</div>

<script>
  // Equal widths for title + content
  // (You already have .input-box.same-width in your CSS; this only ensures both align.)
  (function () {
    const title = document.querySelector('input[name="title"]');
    const content = document.querySelector('textarea[name="content"]');
    if (title && content) {
      title.style.width   = '380px';
      content.style.width = '380px';
    }
  })();

  // Suggestions (auto-fill)
  const TEMPLATES = {{ templates | tojson }};
  const select = document.getElementById('templateSelect');
  select?.addEventListener('change', () => {
    const key = select.value;
    if (!key || !TEMPLATES[key]) return;
    const { title, content } = TEMPLATES[key];
    const titleEl = document.querySelector('input[name="title"]');
    const contentEl = document.querySelector('textarea[name="content"]');
    const typeEl = document.querySelector('select[name="note_type"]');
    if (titleEl) titleEl.value = title || '';
    if (contentEl) contentEl.value = content || '';
    if (typeEl) typeEl.value = key;
  });
</script>

{% endblock %}

